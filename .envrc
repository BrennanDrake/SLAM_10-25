# Direnv environment for this project
# Automatically sources ROS 2 Jazzy and this workspace overlay when you cd into the project root.
# Usage:
#   1) Install direnv and enable the shell hook (see Notes/README.md)
#   2) Run: direnv allow
#   3) cd in/out of the project to auto-activate/deactivate

# Source system ROS 2 (Jazzy)
if [ -f /opt/ros/jazzy/setup.bash ]; then
  source /opt/ros/jazzy/setup.bash
fi

# Source local overlay if built
if [ -f ./ros2_ws/install/setup.bash ]; then
  source ./ros2_ws/install/setup.bash
fi

# Colcon defaults scoped to this repo (enables release mixin by default)
export COLCON_DEFAULTS_FILE="$PWD/colcon-defaults.yaml"

# Optional ROS environment settings
# export ROS_DOMAIN_ID=0                 # set a domain ID to avoid cross-talk on shared networks
# export RMW_IMPLEMENTATION=rmw_fastrtps_cpp  # match with Notes/template_instance.yaml if changed

# Convenience helpers (bash/zsh):
# - sj  : source system ROS 2 (Jazzy)
# - sjw : source system ROS 2 + this workspace overlay (if built)
sj() {
  if [ -f /opt/ros/jazzy/setup.bash ]; then
    # shellcheck disable=SC1091
    . /opt/ros/jazzy/setup.bash
    echo "[env] Sourced /opt/ros/jazzy/setup.bash"
  else
    echo "[env] ROS Jazzy not found at /opt/ros/jazzy/setup.bash" >&2
    return 1
  fi
}

sjw() {
  sj || return 1
  if [ -f ./ros2_ws/install/setup.bash ]; then
    # shellcheck disable=SC1091
    . ./ros2_ws/install/setup.bash
    echo "[env] Sourced workspace overlay: ros2_ws/install/setup.bash"
  else
    echo "[env] Workspace overlay not found. Build first: bash scripts/build.sh" >&2
    return 1
  fi
}
